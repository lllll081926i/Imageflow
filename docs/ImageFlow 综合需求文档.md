# ImageFlow 综合需求文档

**版本**: 3.0 (综合版)
**日期**: 2026年1月13日
**作者**: Manus AI
**项目状态**: 需求确定，准备开发

---

## 目录

1. [执行摘要](#执行摘要)
2. [项目概述](#项目概述)
3. [技术架构](#技术架构)
4. [功能需求](#功能需求)
5. [非功能需求](#非功能需求)
6. [UI/UX 设计规范](#uiux-设计规范)
7. [开发计划](#开发计划)
8. [项目结构](#项目结构)
9. [风险与对策](#风险与对策)

---

## 执行摘要

**ImageFlow** 是一款专为 Windows 平台设计的高性能、轻量级图片处理工具。项目采用 **Wails (v2) + Go + Python** 的现代混合架构，以实现极致的性能、轻量化和开发效率。

### 核心价值主张

| 维度 | 承诺 | 目标 |
| :--- | :--- | :--- |
| **性能** | 单张 1080p 图片处理 < 1秒 | 批量处理支持高并发 |
| **体积** | 便携版 < 50MB | 无需安装，即开即用 |
| **功能** | 8 大核心功能 | 聚焦专注，避免功能蔓延 |
| **体验** | Apple 风格设计 | 简约优雅，易用直观 |
| **开发效率** | 前后端分离 | 各团队独立高效开发 |

### 关键决策

1. **技术栈确定**：Wails + Go + Python (Pillow-core)，而非原始文档中的 Flutter Desktop。
2. **功能精简**：移除所有裁剪功能，聚焦 8 大核心功能。
3. **库选择优化**：以 Pillow 为绝对核心，移除 OpenCV 硬依赖。
4. **架构创新**：Go 作为调度层，Python 作为处理引擎，通过 Pipes 高效通信。

---

## 项目概述

### 1.1. 项目定义

**项目名称**: ImageFlow - 图片快捷转换工具

**项目目标**: 开发一个纯 Windows 平台的图片处理软件，具备以下特点：
- 快速：单张图片处理 < 1秒
- 轻量：应用体积 < 50MB
- 聚焦：8 大核心功能，避免功能冗余
- 美观：Apple 风格设计，简约优雅
- 高效：前后端分离，开发效率高

### 1.2. 目标用户

- **主要用户**: 需要批量处理图片的专业人士（摄影师、设计师、内容创作者）
- **次要用户**: 普通用户，需要快速转换或压缩图片

### 1.3. 项目范围

**包含的功能**:
- 图片格式转换
- 图片压缩
- 批量图片转 PDF
- GIF 拆分
- 图片信息查看
- 图片水印
- 图片调整
- 图片滤镜

**明确排除的功能**:
- 所有形式的图片裁剪（自由裁剪、固定比例裁剪、智能裁剪）
- OCR 文字识别
- AI 图片增强
- 云存储集成

---

## 技术架构

### 2.1. 最终技术栈

| 层级 | 技术 | 版本 | 职责 |
| :--- | :--- | :--- | :--- |
| **前端框架** | Wails | v2 | 应用骨架，Go-JS 双向绑定 |
| **前端界面** | React | v18+ | 用户界面，交互逻辑 |
| **前端语言** | TypeScript | v5+ | 类型安全，开发效率 |
| **主后端** | Go | v1.21+ | 业务逻辑，任务调度，并发控制 |
| **处理引擎** | Python | v3.11+ | 图片处理核心 |
| **核心库** | Pillow | v10.0+ | 图片操作（格式、压缩、调整、水印、滤镜） |
| **PDF 生成** | reportlab | v4.0+ | PDF 文档生成 |
| **EXIF 处理** | piexif | v1.1.3 | 元数据读写 |
| **动画处理** | imageio | v2.33+ | GIF/WebP 帧提取（可选） |
| **进程通信** | Standard I/O | - | Go-Python 通过 Pipes 传递 JSON |
| **打包工具** | Inno Setup | v6.2+ | Windows 安装程序 |

### 2.2. 架构设计

```
┌─────────────────────────────────────────────────────────────┐
│                     前端层 (Wails - React)                   │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  React Components (TypeScript)                       │   │
│  │  - FunctionCard, ImagePreview, DropZone, etc.       │   │
│  │  - State Management (Zustand/Context)               │   │
│  │  - Apple 风格 UI Components                         │   │
│  └──────────────────────────────────────────────────────┘   │
│                           ↕                                   │
│                  Wails JS/Go Bridge                          │
│                  (双向绑定，零开销)                          │
└─────────────────────────────────────────────────────────────┘
                              ↕
┌─────────────────────────────────────────────────────────────┐
│                     后端层 (Go)                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Go Application Core                                 │   │
│  │  - Services (Converter, Compressor, etc.)           │   │
│  │  - Task Queue & Concurrency (goroutine/channel)     │   │
│  │  - File Management & I/O                            │   │
│  │  - Error Handling & Logging                         │   │
│  └──────────────────────────────────────────────────────┘   │
│                           ↕                                   │
│              os/exec (命令行执行)                            │
└─────────────────────────────────────────────────────────────┘
                              ↕
┌─────────────────────────────────────────────────────────────┐
│                  处理引擎层 (Python)                         │
│  ┌──────────────────────────────────────────────────────┐   │
│  │  Python Scripts (CLI-based)                          │   │
│  │  - converter.py, compressor.py, pdf_generator.py    │   │
│  │  - gif_splitter.py, info_viewer.py                  │   │
│  │  - watermark.py, adjuster.py, filter.py             │   │
│  │  - 使用 argparse 解析命令行参数                      │   │
│  │  - 返回 JSON 格式结果                                │   │
│  └──────────────────────────────────────────────────────┘   │
│                           ↕                                   │
│                    Pillow 库生态                             │
│  (+ reportlab, piexif, imageio)                             │
└─────────────────────────────────────────────────────────────┘
```

### 2.3. 通信流程

1. **用户操作** → React 组件捕获事件
2. **调用 Go 方法** → 通过 Wails Bridge 调用 Go 函数
3. **任务分配** → Go 服务层构造命令行参数
4. **执行 Python 脚本** → 使用 `os/exec` 执行对应的 Python 脚本
5. **处理图片** → Python 脚本使用 Pillow 等库处理图片
6. **返回结果** → Python 脚本通过 stdout 返回 JSON 格式结果
7. **解析结果** → Go 解析 JSON 并通过 Wails Events 发送给前端
8. **UI 更新** → React 接收事件，更新界面状态

### 2.4. 为什么选择这个架构

**Go vs. Python 性能对比**:

虽然 Go 作为编译型语言在理论上比 Python 快，但在图片处理场景下：
- Python 的 Pillow、reportlab 等库的**核心算法都是用 C/C++ 编写**的，经过数十年优化。
- Python 本身只是一层"胶水"，实际执行的是高性能的 C 代码。
- 因此，Python 的图片处理性能与 Go 实现相比**并无劣势，甚至可能更优**。

**为什么不用纯 Go**:
- Go 的标准库 `image` 包功能有限，缺乏丰富的图片处理能力。
- 用 Go 从零实现所有功能会导致**开发周期极长、代码复杂度高**。
- 维护成本和 bug 修复难度都会大幅增加。

**为什么不用 Electron**:
- Electron 打包的应用体积通常 > 150MB（包含 Chromium）。
- Wails 利用原生 WebView2，体积可控制在 50MB 以内。
- 内存占用也显著更低。

---

## 功能需求

### 3.1. 功能清单

ImageFlow 提供 8 大核心功能，每个功能都经过精心设计，以满足用户的实际需求。

#### 3.1.1. 图片格式转换

**功能描述**: 支持多种图片格式之间的快速转换，保留图片质量。

**输入格式** (13 种):
JPG/JPEG, PNG, GIF, BMP, TIFF, WEBP, ICO, PSD, TGA, PVR, EXR, PNM (PBM/PGM/PPM)

**输出格式** (7 种):
JPG, PNG, WEBP, BMP, PDF, ICO, CUR

**功能特性**:
- 批量转换支持
- 质量设置 (1-100，适用于 JPG、WEBP)
- 尺寸调整 (百分比、固定尺寸)
- 保持宽高比选项
- 实时进度显示
- 转换前后对比预览

**性能指标**:
- 单张 1080p 图片转换: 200-500ms
- 批量处理 (10 张): 2-3s (多线程)

**实现方案**:
- **Go**: 任务队列、并发管理、文件 I/O
- **Python**: Pillow 库进行格式转换

---

#### 3.1.2. 图片压缩

**功能描述**: 智能压缩图片，在保证质量的前提下最小化文件大小。

**压缩类型**:
- 有损压缩 (JPG、WEBP)
- 无损压缩 (PNG)
- 智能压缩 (自动平衡质量和文件大小)

**功能特性**:
- 批量压缩
- 压缩前后对比预览
- 压缩率显示
- 文件大小对比
- 压缩质量预设 (低、中、高)
- 自定义压缩参数

**性能指标**:
- 单张 1080p 压缩: 400-800ms
- 压缩率: JPG 30-50%, PNG 20-40%

**实现方案**:
- **Go**: 批量任务管理、进度跟踪
- **Python**: Pillow 压缩参数优化、质量预设算法

---

#### 3.1.3. 批量图片转 PDF

**功能描述**: 将多张图片合并成单个 PDF 文档，支持灵活的布局和元数据设置。

**功能特性**:
- 多图合并为单个 PDF
- 自定义页面布局 (单图/2x2/3x3/自定义行列)
- 页面大小设置 (A4、A3、Letter、自定义)
- 页边距设置
- 图片拖拽排序
- PDF 元数据设置 (标题、作者、创建日期)
- 页面方向设置 (横向/纵向)
- 图片自动缩放适应页面

**性能指标**:
- 10 张图片生成 PDF: 1-2s
- 支持 50+ 张图片的批量处理

**实现方案**:
- **Go**: 文件管理、任务调度
- **Python**: reportlab 库进行 PDF 生成和布局

---

#### 3.1.4. GIF 拆分

**功能描述**: 将 GIF 动画拆分为多张静态图片，支持灵活的帧选择。

**功能特性**:
- 拆分 GIF 动画为静态帧
- 选择特定帧导出
- 显示帧数和延迟信息
- 支持导出格式 (PNG、JPG、BMP)
- 帧预览功能
- 批量导出
- 导出所有帧 / 指定范围 / 间隔帧

**性能指标**:
- 50 帧 GIF 拆分: 800ms-1.2s

**实现方案**:
- **Go**: 批量处理、文件管理
- **Python**: Pillow 或 imageio 库进行帧提取

---

#### 3.1.5. 图片信息查看

**功能描述**: 详细查看和编辑图片的元数据和属性。

**显示信息**:
- **基本信息**: 文件名、文件大小、格式、尺寸、色彩模式、位深度
- **EXIF 信息**: 相机品牌/型号、拍摄日期/时间、曝光时间、光圈值、ISO、焦距、闪光灯状态、GPS 坐标
- **直方图**: RGB 直方图、亮度直方图

**功能特性**:
- 支持编辑部分 EXIF 信息
- 信息导出 (TXT、JSON)
- 批量查看
- 缩略图预览

**性能指标**:
- EXIF 读取: < 50ms
- 直方图计算: 100-300ms

**实现方案**:
- **Go**: 文件管理、信息聚合
- **Python**: piexif 读写 EXIF，Pillow 计算直方图

---

#### 3.1.6. 图片水印

**功能描述**: 为图片添加文字或图片水印，支持灵活的位置和样式设置。

**水印类型**:

**文字水印**:
- 自定义文字内容
- 字体选择
- 字体大小
- 字体颜色
- 透明度 (0-100%)
- 位置选择 (九宫格位置)
- 旋转角度

**图片水印**:
- 上传水印图片
- 缩放比例
- 透明度 (0-100%)
- 位置选择 (九宫格位置)
- 旋转角度

**功能特性**:
- 批量添加水印
- 水印预览
- 水印模板保存
- 水印位置微调

**性能指标**:
- 单张水印添加: 200-400ms
- 批量水印 (10 张): 2-4s

**实现方案**:
- **Go**: 批量处理、模板管理
- **Python**: Pillow 进行文字渲染和图像合成

---

#### 3.1.7. 图片调整

**功能描述**: 对图片进行基础调整，包括旋转、翻转和色彩调整。

**调整功能**:
- 旋转 (90°、180°、270°、自定义角度)
- 水平翻转
- 垂直翻转
- 亮度调整 (-100 到 +100)
- 对比度调整 (-100 到 +100)
- 饱和度调整 (-100 到 +100)
- 色相调整 (-180 到 +180)

**功能特性**:
- 实时预览
- 批量处理

**性能指标**:
- 基础调整: 100-300ms

**实现方案**:
- **Go**: 批量任务管理
- **Python**: Pillow.ImageEnhance 进行色彩调整

---

#### 3.1.8. 图片滤镜

**功能描述**: 为图片应用各种滤镜效果，包括基础和高级滤镜。

**基础滤镜** (6 种):
黑白、复古、冷色、暖色、高对比度、柔和

**高级滤镜** (5 种):
模糊 (高斯模糊、运动模糊)、锐化、噪点、晕影、色彩偏移

**功能特性**:
- 滤镜强度调整
- 实时预览
- 批量应用滤镜
- 滤镜组合
- 自定义滤镜参数

**性能指标**:
- 基础滤镜: 200-500ms
- 高级滤镜: 500-1000ms

**实现方案**:
- **Go**: 滤镜参数管理、批量处理
- **Python**: Pillow.ImageFilter 进行滤镜应用

---

### 3.2. 功能优先级

| 优先级 | 功能 | 阶段 |
| :--- | :--- | :--- |
| **P0 (必须)** | 格式转换、压缩、PDF 生成 | 第三阶段 |
| **P1 (重要)** | GIF 拆分、信息查看、水印 | 第三阶段 |
| **P2 (重要)** | 调整、滤镜 | 第三阶段 |

---

## 非功能需求

### 4.1. 性能需求

| 指标 | 目标 | 备注 |
| :--- | :--- | :--- |
| **单张图片处理时间** | < 1秒 (1080p) | 格式转换、压缩等 |
| **GIF 拆分时间** | < 2秒 (50帧) | 帧提取和保存 |
| **批量处理** | 支持多线程并行 | 使用 Go goroutine |
| **应用启动时间** | < 3秒 | 冷启动 |
| **UI 响应时间** | < 100ms | 用户操作反馈 |
| **动画流畅度** | 60fps | 过渡动画、悬停效果 |

### 4.2. 内存需求

| 场景 | 目标 |
| :--- | :--- |
| **空闲状态** | < 200MB |
| **处理大图片** | < 500MB |
| **批量处理** | 动态管理，避免内存溢出 |

### 4.3. 存储需求

| 形式 | 大小限制 |
| :--- | :--- |
| **便携版 (.exe)** | < 50MB |
| **安装版 (.msi)** | < 60MB |

### 4.4. 兼容性需求

| 项目 | 要求 |
| :--- | :--- |
| **操作系统** | Windows 10, Windows 11 |
| **屏幕分辨率** | 1024x768 及以上 |
| **图片格式** | 支持 13 种输入格式 |
| **Python 版本** | 3.11+ (内置或自动下载) |

### 4.5. 可靠性需求

- **错误处理**: 完善的异常捕获和用户提示
- **日志记录**: 详细的操作日志，便于调试
- **数据安全**: 不上传用户数据，所有处理本地完成
- **稳定性**: 支持长时间运行，无内存泄漏

---

## UI/UX 设计规范

### 5.1. 设计风格

**整体风格**: Apple 风格 (简约、优雅、流畅)

**设计原则**:
- 清晰: 信息层次清晰，易于理解
- 一致: 整体视觉风格统一
- 直观: 操作流程直观，无需学习

### 5.2. 色彩系统

**主色调**:
- 主色: #007AFF (Apple 蓝)
- 背景色: #F5F5F7 (浅灰)、#FFFFFF (纯白)
- 文字色: #1D1D1F (深灰)、#86868B (浅灰)

**功能卡片颜色**:

| 功能 | 颜色 | 十六进制 |
| :--- | :--- | :--- |
| 格式转换 | 蓝色 | #007AFF |
| 图片压缩 | 绿色 | #34C759 |
| PDF 生成 | 橙色 | #FF9500 |
| GIF 拆分 | 红色 | #FF3B30 |
| 图片信息 | 灰色 | #8E8E93 |
| 图片水印 | 粉紫 | #AF52DE |
| 图片调整 | 青色 | #32ADE6 |
| 图片滤镜 | 粉红 | #FF2D55 |

**状态色**:
- 成功: #34C759
- 警告: #FF9500
- 错误: #FF3B30

### 5.3. 字体系统

| 用途 | 字体 | 大小 |
| :--- | :--- | :--- |
| 系统字体 | Segoe UI | - |
| 大标题 | Segoe UI | 20px |
| 中标题 | Segoe UI | 18px |
| 小标题 | Segoe UI | 16px |
| 正文 | Segoe UI | 14px |
| 辅助文字 | Segoe UI | 12px |

### 5.4. 组件规范

**圆角**:
- 卡片圆角: 12px
- 按钮圆角: 8px
- 输入框圆角: 6px

**阴影**:
- 卡片阴影: `color: rgba(0,0,0,0.1), blur: 10px, offset: (0, 2px)`
- 悬停阴影: `color: rgba(0,0,0,0.15), blur: 15px, offset: (0, 4px)`

**动画**:
- 过渡时间: 300ms
- 缓动函数: easeInOut
- 悬停效果: 卡片上浮 2px
- 点击效果: 轻微缩放 (0.98)

### 5.5. 主页布局

**布局类型**: 响应式瀑布流

**列数规则**:

| 窗口宽度 | 列数 |
| :--- | :--- |
| < 800px | 2 列 |
| 800px - 1200px | 3 列 |
| 1200px - 1600px | 4 列 |
| > 1600px | 5 列 |

**卡片设计**:
- 最小高度: 200px
- 最大高度: 300px
- 间距: 16px
- 内边距: 24px
- 图标容器: 60x60px，图标: 32px

**功能模块列表** (8 个):

| 序号 | 功能 | 高度 |
| :--- | :--- | :--- |
| 1 | 图片格式转换 | 250px |
| 2 | 图片压缩 | 220px |
| 3 | 批量图片转PDF | 280px |
| 4 | GIF 拆分 | 200px |
| 5 | 图片信息查看 | 210px |
| 6 | 图片水印 | 260px |
| 7 | 图片调整 | 230px |
| 8 | 图片滤镜 | 220px |

### 5.6. 交互设计

- **拖拽上传**: 支持将文件拖拽到应用窗口
- **拖拽排序**: 图片列表支持拖拽重新排序
- **实时预览**: 所有调整实时显示预览效果
- **键盘快捷键**: 常用操作支持快捷键 (如 Ctrl+O 打开文件)
- **右键菜单**: 图片列表支持右键菜单 (删除、复制路径等)

---

## 开发计划

### 6.1. 开发阶段概览

项目分为 6 个阶段，总计约 12-16 周 (假设 2-3 人团队)。

| 阶段 | 名称 | 周期 | 关键产出 |
| :--- | :--- | :--- | :--- |
| 1 | 项目初始化与架构验证 | 1-2 周 | 可运行的极简应用 |
| 2 | UI 框架与组件库建设 | 2-3 周 | 完整的静态 UI |
| 3 | Python 处理引擎开发 | 2-3 周 | 8 个 Python 脚本 |
| 4 | Go 后端业务逻辑集成 | 2-3 周 | 完整的后端 API |
| 5 | 前后端联调与功能完善 | 2-3 周 | 功能完整的应用 |
| 6 | 打包、优化与发布 | 1-2 周 | 便携版 + 安装版 |

### 6.2. 详细阶段计划

#### 第一阶段：项目初始化与架构验证 (1-2 周)

**目标**: 搭建项目骨架，验证 Wails + Go + Python 的通信链路。

**关键任务**:
1. 初始化 Wails 项目 (`wails init -t react-ts`)
2. 配置 Go 项目结构和依赖
3. 创建 Python 测试脚本 (`info.py`)，使用 Pillow 读取图片尺寸
4. 在 Go 中实现 `os/exec` 调用 Python 脚本的逻辑
5. 将 Go 函数暴露给 Wails/React
6. 在 React 中创建测试界面 (文件选择器 + 按钮)
7. 完成端到端的调用链路验证

**产出**:
- 一个可运行的、极简的桌面应用
- 证明了 Wails + Go + Python 的通信通畅
- 建立了项目的基础架构

**技术栈**:
- Wails v2
- Go 1.21+
- React 18 + TypeScript
- Python 3.11+ + Pillow

---

#### 第二阶段：UI 框架与组件库建设 (2-3 周)

**目标**: 根据 Apple 风格设计规范，构建完整的前端组件库和应用布局。

**关键任务**:
1. 实现主应用布局 (侧边栏、内容区、状态栏)
2. 开发基础组件 (按钮、输入框、滑块、下拉菜单、开关等)
3. 开发高级组件:
   - `FunctionCard`: 功能卡片
   - `ImagePreview`: 图片预览窗口
   - `DropZone`: 拖拽上传区域
   - `ProgressBar` / `Spinner`: 进度指示器
4. 实现响应式瀑布流布局
5. 集成 Apple 风格的色彩、字体、动画系统
6. 创建所有 8 个功能页面的静态布局

**产出**:
- 完整的 React 组件库
- 所有页面的静态 UI
- 统一的视觉风格

**技术栈**:
- React 18 + TypeScript
- Tailwind CSS 或 CSS Modules
- Zustand (状态管理)

---

#### 第三阶段：Python 图片处理引擎开发 (2-3 周)

**目标**: 开发所有核心图片处理功能的独立 Python 脚本。

**关键任务**:

为每个功能创建独立的 Python 脚本，使用 `argparse` 定义命令行接口，返回 JSON 格式结果：

1. **converter.py** - 格式转换
   - 参数: `--input`, `--output`, `--format`, `--quality`, `--width`, `--height`, `--keep-ratio`
   - 返回: 转换结果、文件大小、处理时间

2. **compressor.py** - 图片压缩
   - 参数: `--input`, `--quality`, `--mode` (lossy/lossless/smart)
   - 返回: 压缩率、原始大小、压缩后大小

3. **pdf_generator.py** - PDF 生成
   - 参数: `--images`, `--output`, `--layout`, `--page-size`, `--margin`, `--metadata`
   - 返回: PDF 生成结果

4. **gif_splitter.py** - GIF 拆分
   - 参数: `--input`, `--output-dir`, `--format`, `--frame-range`, `--interval`
   - 返回: 拆分帧数、文件列表

5. **info_viewer.py** - 图片信息查看
   - 参数: `--input`, `--export-format` (txt/json)
   - 返回: 基本信息、EXIF 数据、直方图数据

6. **watermark.py** - 图片水印
   - 参数: `--input`, `--output`, `--type` (text/image), `--content`, `--position`, `--opacity`, `--angle`
   - 返回: 水印添加结果

7. **adjuster.py** - 图片调整
   - 参数: `--input`, `--output`, `--rotate`, `--flip`, `--brightness`, `--contrast`, `--saturation`, `--hue`
   - 返回: 调整结果

8. **filter.py** - 图片滤镜
   - 参数: `--input`, `--output`, `--filter-type`, `--intensity`
   - 返回: 滤镜应用结果

**产出**:
- 8 个功能完整的 Python 脚本
- 单元测试覆盖
- 性能基准测试结果

**技术栈**:
- Python 3.11+
- Pillow 10.0+
- reportlab 4.0+
- piexif 1.1.3
- imageio 2.33+ (可选)

---

#### 第四阶段：Go 后端业务逻辑集成 (2-3 周)

**目标**: 在 Go 后端编写业务逻辑，封装对 Python 脚本的调用。

**关键任务**:
1. 创建 Go 服务层，为每个功能模块创建对应的 Service
2. 实现 `PythonExecutor` 工具类，负责:
   - 构造命令行参数
   - 执行 Python 脚本
   - 捕获 stdout/stderr
   - 解析 JSON 结果
   - 错误处理
3. 为每个功能实现 Go 服务方法:
   - `ConvertImage()`, `CompressImage()`, `GeneratePDF()`, `SplitGIF()`, `GetImageInfo()`, `AddWatermark()`, `AdjustImage()`, `ApplyFilter()`
4. 实现批量操作的并发处理:
   - 使用 `goroutine` 和 `channel` 实现高效的并发执行
   - 实现任务队列和进度跟踪
5. 建立完善的错误处理和日志记录机制
6. 将所有 Go 函数绑定到 Wails 实例

**产出**:
- 完整的 Go 后端
- 所有业务逻辑均已实现
- 完善的错误处理和日志系统

**技术栈**:
- Go 1.21+
- Wails v2
- 标准库 (os/exec, encoding/json, log)

---

#### 第五阶段：前后端联调与功能完善 (2-3 周)

**目标**: 将前端 UI 与后端 Go API 全面对接，完成所有功能的闭环。

**关键任务**:
1. 在 React 组件中调用 Wails 提供的全局 Go 方法
2. 实现状态管理:
   - 使用 Zustand 或 React Context 管理应用状态
   - 管理待处理文件列表、任务进度、设置参数等
3. 实现实时反馈:
   - 利用 Wails 的事件系统 (`Wails.Events.On`)
   - Go 后端在处理过程中发送事件给前端
   - React 接收事件，更新进度条和 UI 状态
4. 完善交互细节:
   - 拖拽排序
   - 实时预览
   - 参数调整即时生效
   - 错误提示和成功反馈
5. 全面测试:
   - 功能测试 (所有功能模块)
   - 边界情况测试
   - 错误处理测试
   - 性能测试

**产出**:
- 功能完整的应用程序
- 前后端完全打通
- 所有功能可用

**技术栈**:
- React 18 + TypeScript
- Zustand
- Wails Events

---

#### 第六阶段：打包、优化与发布 (1-2 周)

**目标**: 对应用进行性能优化、错误修复，并打包成便携版和安装版。

**关键任务**:
1. 性能分析与优化:
   - 分析启动速度，优化初始化逻辑
   - 分析处理速度，优化 Python 脚本
   - 分析内存占用，优化数据结构
   - 使用 Go 的 pprof 和 React DevTools 进行性能分析
2. 打包配置:
   - 在 `wails.json` 中配置应用图标、版权、版本信息
   - 优化前端代码 (压缩、tree-shaking)
   - 配置 Python 依赖的打包方式
3. 构建可执行文件:
   - 运行 `wails build` 命令
   - 生成独立的、无需安装的便携版 `.exe` 文件
   - 验证文件大小 < 50MB
4. 制作安装包:
   - 使用 Inno Setup 工具
   - 创建专业的 Windows 安装程序 (.msi)
   - 实现桌面快捷方式、开始菜单项、卸载功能
5. 全面测试:
   - Windows 10 / Windows 11 兼容性测试
   - 不同屏幕分辨率测试
   - 不同图片格式测试
   - 长时间运行测试 (内存泄漏检测)

**产出**:
- `.exe` 便携版 (< 50MB)
- `.msi` 安装包 (< 60MB)
- 完整的测试报告

**技术栈**:
- Wails build
- Inno Setup
- 性能分析工具

---

### 6.3. 里程碑

| 里程碑 | 时间 | 产出 |
| :--- | :--- | :--- |
| **M1: 架构验证** | 第 2 周 | 可运行的极简应用 |
| **M2: UI 完成** | 第 5 周 | 完整的静态 UI |
| **M3: 引擎完成** | 第 8 周 | 所有 Python 脚本 |
| **M4: 后端完成** | 第 11 周 | 完整的 Go 后端 |
| **M5: 功能完成** | 第 14 周 | 功能完整的应用 |
| **M6: 发布** | 第 16 周 | 便携版 + 安装版 |

---

## 项目结构

### 7.1. 目录结构

```
imageflow/
├── frontend/                        # React 前端项目
│   ├── src/
│   │   ├── components/              # React 组件库
│   │   │   ├── common/              # 通用组件
│   │   │   │   ├── Button.tsx
│   │   │   │   ├── Input.tsx
│   │   │   │   ├── Slider.tsx
│   │   │   │   └── ...
│   │   │   ├── features/            # 功能组件
│   │   │   │   ├── FunctionCard.tsx
│   │   │   │   ├── ImagePreview.tsx
│   │   │   │   ├── DropZone.tsx
│   │   │   │   ├── ProgressBar.tsx
│   │   │   │   └── ...
│   │   ├── pages/                   # 页面组件
│   │   │   ├── Home.tsx             # 主页
│   │   │   ├── Converter.tsx        # 格式转换
│   │   │   ├── Compressor.tsx       # 图片压缩
│   │   │   ├── PdfGenerator.tsx     # PDF 生成
│   │   │   ├── GifSplitter.tsx      # GIF 拆分
│   │   │   ├── InfoViewer.tsx       # 图片信息
│   │   │   ├── Watermark.tsx        # 图片水印
│   │   │   ├── Adjuster.tsx         # 图片调整
│   │   │   ├── Filter.tsx           # 图片滤镜
│   │   │   └── ...
│   │   ├── store/                   # 状态管理 (Zustand)
│   │   │   ├── appStore.ts
│   │   │   ├── imageStore.ts
│   │   │   └── ...
│   │   ├── styles/                  # 全局样式
│   │   │   ├── globals.css
│   │   │   ├── theme.css
│   │   │   └── ...
│   │   ├── types/                   # TypeScript 类型定义
│   │   │   ├── image.ts
│   │   │   ├── task.ts
│   │   │   └── ...
│   │   ├── App.tsx
│   │   ├── main.tsx
│   │   └── wailsjs/                 # Wails 自动生成的 JS 绑定
│   ├── package.json
│   ├── tsconfig.json
│   ├── vite.config.ts
│   └── ...
├── backend/                         # Go 后端项目
│   ├── main.go                      # 应用入口
│   ├── app.go                       # Wails 应用结构
│   ├── services/                    # 业务逻辑层
│   │   ├── converter.go             # 格式转换服务
│   │   ├── compressor.go            # 图片压缩服务
│   │   ├── pdf_generator.go         # PDF 生成服务
│   │   ├── gif_splitter.go          # GIF 拆分服务
│   │   ├── info_viewer.go           # 图片信息服务
│   │   ├── watermark.go             # 水印服务
│   │   ├── adjuster.go              # 调整服务
│   │   ├── filter.go                # 滤镜服务
│   │   └── ...
│   ├── utils/                       # 工具类
│   │   ├── python_executor.go       # Python 脚本执行器
│   │   ├── error_handler.go         # 错误处理
│   │   ├── logger.go                # 日志记录
│   │   └── ...
│   ├── go.mod
│   ├── go.sum
│   └── ...
├── python/                          # Python 处理引擎
│   ├── converter.py                 # 格式转换脚本
│   ├── compressor.py                # 图片压缩脚本
│   ├── pdf_generator.py             # PDF 生成脚本
│   ├── gif_splitter.py              # GIF 拆分脚本
│   ├── info_viewer.py               # 图片信息脚本
│   ├── watermark.py                 # 水印脚本
│   ├── adjuster.py                  # 调整脚本
│   ├── filter.py                    # 滤镜脚本
│   ├── requirements.txt             # Python 依赖
│   ├── utils.py                     # 工具函数
│   └── ...
├── wails.json                       # Wails 配置文件
├── README.md
├── LICENSE
└── ...
```

### 7.2. 核心文件说明

**frontend/src/App.tsx**:
主应用组件，负责路由、全局状态、事件监听等。

**backend/app.go**:
Wails 应用结构，定义所有暴露给前端的方法。

**backend/utils/python_executor.go**:
Python 脚本执行器，负责构造命令行、执行脚本、解析结果。

**python/requirements.txt**:
Python 依赖列表，包含 Pillow、reportlab、piexif 等。

---

## 风险与对策

### 8.1. 技术风险

| 风险 | 影响 | 概率 | 对策 |
| :--- | :--- | :--- | :--- |
| **Wails 版本不稳定** | 应用崩溃、功能失效 | 低 | 使用稳定版本 v2.x，定期更新 |
| **Go-Python 通信延迟** | 性能下降 | 中 | 优化 JSON 序列化，使用缓存 |
| **Python 环境配置复杂** | 用户安装困难 | 中 | 内置 Python 运行时，或提供自动下载 |
| **大文件处理内存溢出** | 应用崩溃 | 中 | 实现流式处理，分块处理大文件 |
| **跨平台兼容性问题** | 功能在某些系统上失效 | 低 | 充分的 Windows 10/11 测试 |

### 8.2. 项目风险

| 风险 | 影响 | 概率 | 对策 |
| :--- | :--- | :--- | :--- |
| **功能范围蔓延** | 延期、成本增加 | 中 | 严格的需求管理，明确的功能范围 |
| **人员变动** | 进度延期 | 低 | 完善的文档、代码注释、知识转移 |
| **第三方库更新** | 兼容性问题 | 低 | 锁定库版本，定期更新测试 |

### 8.3. 性能风险

| 风险 | 影响 | 概率 | 对策 |
| :--- | :--- | :--- | :--- |
| **处理大图片超时** | 用户体验差 | 中 | 实现超时控制、进度反馈、取消功能 |
| **内存占用过高** | 系统卡顿 | 中 | 定期的内存分析、优化算法 |
| **应用启动慢** | 用户流失 | 中 | 延迟加载、预加载优化 |

---

## 总结

ImageFlow 项目通过采用 **Wails + Go + Python** 的现代混合架构，在保证强大功能的同时，实现了极致的轻量化和高性能。项目聚焦于 8 大核心功能，避免功能蔓延，确保产品的专注性和易用性。

通过清晰的开发阶段、完善的技术规范和风险对策，我们有信心在 12-16 周内交付一款高质量的、用户体验卓越的桌面图片处理工具。

---

**文档版本历史**:
- v1.0 (2026-01-13): 初始版本，包含原始需求
- v2.0 (2026-01-13): 修订版本，移除裁剪功能，优化技术栈
- v3.0 (2026-01-13): 综合版本，整合所有分析和决策

**下一步行动**:
1. 组建开发团队 (前端、后端、测试)
2. 搭建开发环境和工具链
3. 启动第一阶段开发 (项目初始化与架构验证)
4. 建立定期的进度同步机制
