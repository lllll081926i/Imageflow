# ImageFlow 最终开发文档

**版本**: 1.0
**日期**: 2026年1月13日
**作者**: Manus AI

## 1. 项目概述

本文档为 **ImageFlow** 项目提供了一套完整、最终确定的开发指南。项目旨在基于 **Wails + Go + Python** 这一高效、轻量的技术栈，打造一款专注、高性能的 Windows 桌面图片处理工具。本文档确定的技术方案与功能范围，将作为项目开发的最终依据。

### 1.1. 最终技术栈

经过深入评估与讨论，项目将采用以下技术栈，以最大化发挥各组件优势：

| 层级        | 技术                       | 角色与职责                                                       |
| :-------- | :----------------------- | :---------------------------------------------------------- |
| **前端框架**  | **Wails (v3)**           | 提供应用骨架，负责 Go 后端与 Web 前端的原生双向绑定。                             |
| **前端界面**  | **React (TypeScript)**   | 使用现代 Web 技术构建流畅、美观且响应式的用户界面。                                |
| **主后端**   | **Go**                   | 编写应用核心业务逻辑，包括文件管理、任务调度、高并发控制，并作为调用 Python 引擎的中间层。           |
| **处理引擎**  | **Python (Pillow-core)** | 执行所有核心图片处理任务。**以** **`Pillow`** **库为核心**，确保轻量与高效。           |
| **通信机制**  | **Wails JS/Go Bridge**   | 用于前端与 Go 后端之间近乎零开销的方法调用和事件传递。                               |
| **进程间通信** | **Standard I/O (Pipes)** | Go 后端通过执行命令行程序的方式调用 Python 脚本，并通过标准输入输出（Pipes）高效传递 JSON 数据。 |


## 2. 最终功能范围 (Scope of Work)

根据最终确认，项目将聚焦于以下核心功能，**所有裁剪相关功能已从本次开发范围中移除**，以确保产品的核心价值和轻量化。

### 2.1. 包含功能

| 核心功能         | 具体特性                              |
| :----------- | :-------------------------------- |
| **图片格式转换**   | 批量转换、质量设置、尺寸调整、保持宽高比。             |
| **图片压缩**     | 有损/无损压缩、批量处理、压缩前后对比、压缩率显示。        |
| **批量图片转PDF** | 多图合并、自定义页面布局、页面大小/边距设置、元数据设置。     |
| **GIF 拆分**   | 拆分为静态帧、选择特定帧导出、帧信息显示。             |
| **图片信息查看**   | 基本信息、EXIF 数据查看与编辑、RGB 直方图。        |
| **图片水印**     | 文字水印、图片水印、批量添加、透明度/位置/旋转设置。       |
| **图片滤镜**     | 基础滤镜（黑白、复古等）、高级滤镜（模糊、锐化等）、滤镜强度调整。 |
| **图片调整**     | 旋转、翻转、亮度、对比度、饱和度、色相调整。            |

### 2.2. 明确排除的功能

- **所有形式的图片裁剪功能** (包括自由裁剪、固定比例裁剪、智能裁剪)。

- **OCR 文字识别**。

- **AI 图片增强**。

***

## 3. 核心依赖库

为保证轻量化，Python 处理引擎将严格控制依赖，以 `Pillow` 为绝对核心。

| 库名              | 主要用途                                    | 备注    |
| :-------------- | :-------------------------------------- | :---- |
| **`Pillow`**    | **核心库**。负责格式转换、压缩、调整、水印、滤镜、信息读取等绝大部分功能。 | 必须依赖  |
| **`reportlab`** | 专用于高性能的 PDF 文档生成。                       | 必须依赖  |
| **`piexif`**    | 轻量级的 EXIF 数据读写工具。                       | 必须依赖  |
| **`imageio`**   | (可选) 用于更复杂的动画 GIF/WebP 处理。              | 可按需引入 |

***

## 4. 详细开发顺序

项目开发将遵循以下六个阶段，确保从架构验证到功能实现再到最终交付的流程清晰、可控。

### **第一阶段：项目初始化与架构验证 (The Spine)**

- **目标**：搭建项目骨架，打通从前端到 Python 引擎的完整调用链路。

- **关键任务**：

  1. **初始化 Wails 项目** (`wails init -t react-ts`)。
  2. **创建 Python 测试脚本** (`info.py`)，接收图片路径，使用 `Pillow` 返回图片尺寸的 JSON。
  3. **建立 Go-Python 通信**：在 Go 中使用 `os/exec` 调用 `info.py` 并捕获其输出。
  4. **暴露 Go 方法给前端**：将 Go 函数绑定到 Wails 实例。
  5. **创建前端测试界面**：在 React 中创建文件选择器和按钮，调用 Go 方法并显示返回结果。

- **产出**：一个可运行的、极简的应用，证明端到端通信通畅。

### **第二阶段：UI 框架与组件库建设**

- **目标**：根据 UI/UX 设计稿，构建一套完整、统一、可复用的前端组件库和应用布局。

- **关键任务**：

  1. 实现主应用布局（侧边栏、内容区、状态栏）。
  2. 开发基础组件（按钮、输入框、滑块等）。
  3. 开发高级组件（功能卡片、图片预览窗口、拖拽区域、进度条）。
  4. 实现主页的响应式瀑布流布局。

- **产出**：一个拥有完整视觉风格和交互框架的静态 UI 应用。

### **第三阶段：Python 图片处理引擎开发**

- **目标**：开发所有核心图片处理功能的独立 Python 脚本。

- **关键任务**：

  1. 为每个功能创建独立的、可通过命令行调用的 Python 脚本 (e.g., `converter.py`, `compressor.py`, `pdf_generator.py` 等)。
  2. 使用 `argparse` 为每个脚本定义清晰的命令行接口。
  3. **具体脚本开发 (全部基于 Pillow)**：

     - **格式转换、压缩、调整、水印、滤镜**：使用 `Pillow` 库相应模块。

     - **PDF 生成**：使用 `reportlab` 库。

     - **GIF 拆分**：使用 `Pillow` 库的 `ImageSequence` 模块。

     - **信息查看**：使用 `Pillow` 读取基本信息，`piexif` 读写 EXIF。

- **产出**：一套功能完整、经过单元测试的 Python 图片处理工具集。

### **第四阶段：Go 后端业务逻辑集成**

- **目标**：在 Go 后端编写业务逻辑，封装对 Python 脚本的调用，并为前端提供简洁、统一的 API。

- **关键任务**：

  1. 为每个功能模块创建对应的 Go 服务。
  2. 封装对 Python 脚本的命令行调用，处理参数传递和结果解析。
  3. 使用 `goroutine` 和 `channel` 实现批量操作的高并发执行。
  4. 建立完善的错误处理和日志记录机制。
  5. 将所有 Go 服务函数绑定到 Wails 实例，供前端调用。

- **产出**：一个功能完备的 Go 后端，所有业务逻辑均已封装成对前端友好的接口。

### **第五阶段：前后端联调与功能完善**

- **目标**：将前端 UI 与后端 Go API 全面对接，完成所有功能的闭环。

- **关键任务**：

  1. 在 React 组件中调用 Wails 提供的全局 Go 方法。
  2. 使用 `Zustand` 或 `React Context` 管理应用状态。
  3. 利用 Wails 的事件系统 (`Wails.Events.On`) 实现处理过程中的实时进度反馈。
  4. 完善交互细节，如拖拽排序、实时预览等。

- **产出**：一个功能完整、前后端完全打通的、可供测试的应用程序。

### **第六阶段：打包、优化与发布**

- **目标**：对应用进行性能优化、错误修复，并打包成便携版和安装版进行发布。

- **关键任务**：

  1. 性能分析与优化（启动速度、处理速度、内存占用）。
  2. 在 `wails.json` 中配置应用图标、版权和版本信息。
  3. 运行 `wails build` 命令，生成独立的便携版 `.exe` 文件。
  4. 使用 **Inno Setup** 工具为 `.exe` 文件创建专业的 Windows 安装程序。
  5. 在 Windows 10/11 上进行全面的兼容性和性能测试。

- **产出**：最终交付给用户的 `.exe` 便携版和安装包。

***

## 5. 总结

本开发文档确立了 ImageFlow 项目的最终技术方向和开发蓝图。通过采用 **Wails + Go + Python (Pillow-core)** 的精简技术栈，并聚焦于核心功能，我们将在保证强大功能的同时，实现极致的轻量化和高性能，为用户交付一款卓越的桌面图片处理工具。
